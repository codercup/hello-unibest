import{d as e,r as a,a2 as n,o as s,c as t,w as c,a3 as o,f as l,a as u,b as r,t as i,u as f,Q as d,s as g,a4 as b,a5 as h,e as p,_ as v}from"./index-876e1fe2.js";const m=e({name:"sign"}),y=v(e({...m,setup(e){const v=a(!1),m=a(!1);let y=null,T=!1,x=[],_=[];function w(){y=o("canvas"),y.lineWidth=4,y.lineCap="round",y.lineJoin="round"}function k(e){const a=x[0],n=x[1];e||_[_.length-1].push(JSON.parse(JSON.stringify(x))),x.shift(),y.moveTo(a.X,a.Y),y.lineTo(n.X,n.Y),y.stroke(),y.draw(!0),m.value=!0}function C(){_.push([]),y.beginPath(),T=!0}function J(e){if(T){let a={};if(e.changedTouches[0].x)a={X:e.changedTouches[0].x,Y:e.changedTouches[0].y};else{a={X:e.changedTouches[0].pageX-e.currentTarget.offsetLeft,Y:e.changedTouches[0].pageY-e.currentTarget.offsetTop}}x.push(a);x.length>=2&&k()}}function X(){_=_.filter((e=>e.length>0)),x=[],T=!1}function Y(e){e&&(_=[]),y.clearRect(0,0,1e3,1e3),y.draw(!0),m.value=!1}function N(){Y(!0),v.value=!v.value;const e=setTimeout((()=>{w(),clearTimeout(e)}),100)}function O(){if(Y(),_.length<=1)return _=[],void(x=[]);_.pop(),_.forEach((e=>{e.forEach((e=>{x=JSON.parse(JSON.stringify(e)),k(1)}))}))}const S=()=>{m.value?b({canvasId:"canvas",success:e=>{const{tempFilePath:a}=e;!function(e,a){const n=new Image;n.src=e;const s=document.createElement("a");s.download=a||"canvas-image",s.href=n.src,s.click()}(a,`sign-${(new Date).getTime()}`)},fail:()=>{g({title:"转换图片失败",icon:"none"})}}):g({title:"请签名",icon:"none"})};return n((()=>{w()})),(e,a)=>{const n=h,o=p,g=l("layout-default-uni");return s(),t(g,null,{default:c((()=>[u(o,{class:d(["canvas-box flex flex-col box-border p-3",{"full-screen":f(v)}])},{default:c((()=>[u(n,{"canvas-id":"canvas",class:"w-full b b-dashed b-rd b-gray-300 canvas","disable-scroll":!0,onTouchstart:C,onTouchmove:J,onTouchend:X,onMousedown:C,onMousemove:J,onMouseup:X}),u(o,{class:"btns flex justify-between text-center box-border"},{default:c((()=>[u(o,{class:"btn-box flex"},{default:c((()=>[u(o,{class:"btn bg-gray-100 b-rd b-gray-300 c-gray-500 p-1",onClick:N},{default:c((()=>[r(i(f(v)?"退出全屏":"全屏"),1)])),_:1}),u(o,{class:"btn bg-gray-100 b-rd b-gray-300 c-gray-500 p-1 ml-2",onClick:Y},{default:c((()=>[r("清空")])),_:1}),u(o,{class:"btn bg-gray-100 b-rd b-gray-300 c-gray-500 p-1 ml-2",onClick:O},{default:c((()=>[r(" 撤回 ")])),_:1})])),_:1}),u(o,{class:"btn-box flex"},{default:c((()=>[u(o,{class:"btn bg-sky-500 b-rd c-white p-1",onClick:S},{default:c((()=>[r("保存")])),_:1})])),_:1})])),_:1})])),_:1},8,["class"])])),_:1})}}}),[["__scopeId","data-v-52f0da0d"]]);export{y as default};
